name: Deploy Laravel to Azure

on:
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Download artifact from Build workflow
      uses: dawidd6/action-download-artifact@v3
      with:
        repo: AngelJeffersonJ/Proyecto_Laravel
        workflow: build.yml   # ðŸ‘ˆ ESTE es el verdadero workflow fuente
        name: php-app
        path: ./artifact
        check_artifacts: true
        allow_forks: true

    - name: Check artifact contents
      run: ls -R ./artifact

    - name: Azure Login
      uses: azure/login@v2
      with:
        auth-type: IDENTITY
        audience: api://AzureADTokenExchange

    - name: Deploy ZIP to App Service
      uses: azure/webapps-deploy@v3
      with:
        app-name: "RG-Laravel"
        package: "./artifact/php-app.zip"
